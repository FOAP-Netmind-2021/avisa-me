<!DOCTYPE html>
<html>
  <head>
    <title></title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
  </head>
  <body>
   
    <div>
      <% if(workSpace){ %>
        <form action="/addTask" method="POST">
        <input type="hidden" name="id" value="<%= workSpace._id %>">
        <% }else{ %>  
      <form action="/" method="POST">
        <% } %> 
        <label for="title">Title</label>
        <input type="text" name="title" id="title" maxlength="140">

        <label for="text">Text</label>
        <input type="text" name="text" id="text" maxlength="5000">

        <input type="submit" value="AÃ±adir Nota">

      </form>
      <% if(workSpace){ %> 
      <div>
        <% workSpace.tasks.forEach(task => { %>
        <div data-id="<%= task._id %> " onfocusout="onFocusUpdate(event)" id="taskContainer" style="border:1px solid black">
         <p contenteditable="true"><%= task.title %></p> 
         <p contenteditable="true"><%= task.text  %> </p>
        </div>
          <% }) %> 
      </div>
      <% } %> 
    </div>
    <script>
      function onFocusUpdate(event){
        let divFather = document.querySelector("#taskContainer");
        let idNote = divFather.dataset.id;
        let titleModified =  event.currentTarget.children[0].textContent;
        let parafModified = event.currentTarget.children[1].textContent;
        let data = {idNote, titleModified, parafModified};
        let response = fetch("/tasks/updateTask", {
        method: "POST",
        body: JSON.stringify(data),
        headers:{ //es necesario
          'Content-Type': 'application/json'
        }
        }).then(()=>{
          console.log("response:", response);
          console.log("data:", data);
        })
      }

    </script>
  </body>
</html>
